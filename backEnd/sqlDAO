
var express = require('express');
var app = express();
require('dotenv').config();
var pmysql = require('promise-mysql'); //promise-mysql is a wrapper for mysql that allows us to use promises instead of callbacks

var pool;

const username = process.env.SQLDB_USER;
const password = process.env.SQLDB_PASSWORD;
const database = process.env.SQLDB_DATABASE;
const host = process.env.SQLDB_HOST;
const port = process.env.SQLDB_PORT;
const connectionLimit = process.env.SQLDB_CONNECTION_LIMIT;   

pmysql.createPool({
    connectionLimit : connectionLimit,
    host : host,
    user : username,
    password : password,
    database : database , //database name
    port : port
}).then(p => {
    pool = p;
}).catch(err => {
    console.log("Pool Error: " +err);
});

function getStore() {
    return new Promise((resolve, reject) => {
     pool.query('SELECT * FROM store')
        .then((data) => {
            resolve(data);
        })
        .catch(err => {
            reject(err);
        })
    })
}


function updateStore() {
    return new Promise((resolve, sreject) => {
        pool.query('UPDATE FROM store WHERE sid = ?', [sid])//TODO: amend name of table
        .then((data => {
            resolve(data);
        }))
        .catch(err => {
            sreject(err);
        });
    });
}

function addStore() { 
    return new Promise((resolve, sreject) => {
        pool.query('INSERT INTO store (sid, location, mgrid) VALUES (?, ?, ?)', [sid, location, mgrid])
        .then((data) => {
            resolve(data);
        })
        .catch(err => {
            sreject(err);
        });
    });
}


module.exports = { getStore, addStore, };